var hasProp={}.hasOwnProperty;!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){var t,i,s,n;e.fn.check=function(){return this.each(function(){return e(this).prop("indeterminate",!1).prop("checked",!0)})},e.fn.uncheck=function(){return this.each(function(){return e(this).prop("indeterminate",!1).prop("checked",!1)})},e.fn.semicheck=function(){return this.each(function(){return e(this).prop("indeterminate",!0).prop("checked",!1)})},e.fn.togglecheck=function(){return this.each(function(){var t;return t=e(this),t.prop("checked",!t.prop("checked"))})},s={data:[],ajax:!1,url:"./",requestSettings:{},responseHandler:function(e){return e},animationSpeed:400,hideFiles:!1,fileNodeName:"name",folderNodeName:"name",fileNodeTitle:"name",folderNodeTitle:"name",nodeFormatter:function(e){return e},columnView:!1,dblclickDelay:200,classes:{arrow:"glyphicon glyphicon-chevron-right"},searchInput:null,checkboxes:!1,hierarchialCheck:!0},t=function(){function t(t,i){this.element=t,this.settings=e.extend({},s,i),this._defaults=s,this._clicks=0,this._timer=null,this._itemId=0,this._lookup={},this.settings.checkboxes=this.settings.columnView?!1:void 0,this._init()}return t.prototype.open=function(t){var i;return i=e(t).closest("li"),i.hasClass("folder")?(this._openFolder(i),this):!1},t.prototype.close=function(t){var i;return i=e(t).closest("li"),i.hasClass("folder")?(this._closeFolder(i),this):!1},t.prototype.toggle=function(t){var i;return this.settings.columnView||(i=e(t).closest("li"),i.hasClass("is-collapsed")?this._openFolder(i):i.hasClass("is-expanded")&&this._closeFolder(i)),this},t.prototype.select=function(t){return this._selectItem(e(t).closest("li")),this.settings.checkboxes&&e(t).siblings("input[type=checkbox]").togglecheck().change(),this},t.prototype.getSelectedNodes=function(){return this.settings.checkboxes&&e(this.element).find("input[type=checkbox]:checked").map(function(t,i){return e(i).siblings("a")}).get(),!1},t.prototype.getActivePath=function(){var t;return t=this.settings.columnView?e(this.element).find(".active"):e(this.element).find(".active > a").parentsUntil(this.element,"li.folder"),t=t.map(function(t,i){return e(i).find("> a").text()}).get(),this.settings.columnView||t.reverse(),t.join("/")},t.prototype.expandTo=function(t){var i,s,n,l,r,o,a,c;if(t=t.replace(/^\/|\/$/g,"").split("/"),i=e(this.element),this.settings.columnView)for(i=i.find("> .list-group-wrapper"),l=r=0,a=t.length;a>r;l=++r){if(s=t[l],n=i.find("> .columns").eq(l).find("> ul.list-group > li > a").filter(function(){return e(this).text()===s}),n.length<1)throw new Error("The folder/file "+s+" does not exists");this.open(n),l===t.length-1&&e(n).click()}else for(this.collapseAll(!0),l=o=0,c=t.length;c>o;l=++o){if(s=t[l],i=i.find("> ul.list-group > li").filter(function(){return e(this).find("> a").text()===s}),i.length<1)throw new Error("The folder/file "+s+" does not exists");this._openFolder(i),this._selectItem(i),l===t.length-1&&i.find("> a").click()}return this},t.prototype.expandAll=function(t){var i;return this.settings.columnView||(i=this,t&&(this.settings._animationSpeed=this.settings.animationSpeed,this.settings.animationSpeed=0),e(this.element).find("li.folder.is-collapsed > a").each(function(e,t){return i.open(t)}),t&&(this.settings.animationSpeed=this.settings._animationSpeed,delete this.settings._animationSpeed)),this},t.prototype.collapseAll=function(t){var i;return i=this,this.settings.columnView?e(this.element).find(".columns:not(:first-child)").remove().end().find(".active").removeClass("active"):(t&&(this.settings._animationSpeed=this.settings.animationSpeed,this.settings.animationSpeed=0),e(this.element).find("li.folder.is-expanded > a").each(function(e,t){return i.close(t)}),t&&(this.settings.animationSpeed=this.settings._animationSpeed,delete this.settings._animationSpeed)),this},t.prototype.destroy=function(){return e(this.element).data("$.filetree",null),e(this.element).off().empty(),this},t.prototype._init=function(){var t,i,s,n,l;return l=this,t=e(this.element).addClass("file-tree"),i=e(document.createElement("span")).insertAfter(e(this.element)),e(this.element).detach(),this.settings.columnView&&(t.addClass("file-tree-columns"),t=e(document.createElement("div")).addClass("list-group-wrapper").appendTo(t)),s=this.settings.data,n=this,this.settings.ajax?e.ajax(this.settings.url,this.settings.requestSettings).then(function(e){return e=n.settings.responseHandler(e),n._createTree.call(n,t,e)}):e.isArray(s)&&s.length>0?this._createTree.call(this,t,s):this._parseTree.call(this,t),this._addListeners(),e(this.element).insertBefore(i),i.remove(),s=null,this.element},t.prototype._createTree=function(t,i,s){var n,l,r,o,a,c,d,h,p,u,f,m,g,y,v,_,k,C,w,b,x;for(null==s&&(s="/"),n=e(t),l=[],r=[],m=0,v=i.length;v>m;m++)u=i[m],"folder"===u.type&&r.push(u),"file"===u.type&&l.push(u);for(l.sort(this._nameSort),r.sort(this._nameSort),i=r.concat(l),b=e(document.createElement("ul")).addClass("list-group"),g=0,_=i.length;_>g;g++)if(f=i[g],"file"!==f.type||this.settings.hideFiles!==!0){k=e(document.createElement("li")).addClass(f.type+" list-group-item"),a=e(document.createElement("a")).attr("href","#").data("__itemId",++this._itemId),["file","folder"].indexOf(f.type)>-1?(w=f[this.settings[f.type+"NodeTitle"]],C=f[this.settings[f.type+"NodeName"]],p=s+f[this.settings[f.type+"NodeName"]]):(w=C=f.name,p=s+f.name),a.attr("title",w).html(C).data("__path",p),this._lookup[this._itemId+":"+C]=a;for(y in f)hasProp.call(f,y)&&(x=f[y],"children"!==y&&a.data(y,x));this.settings.columnView&&"folder"===f.type&&(c=e(document.createElement("span")).addClass("arrow "+this.settings.classes.arrow),a.append(c)),k.append(a),this.settings.multiselect&&(d=e(document.createElement("input")).attr("type","checkbox"),f.readOnly&&(d.prop("disabled",!0),k.addClass("is-read-only")),k.prepend(d)),"folder"===f.type&&(k.addClass("is-collapsed"),("undefined"===f.children||f.children.length<1)&&k.addClass("is-empty"),this.settings.columnView||(c=e(document.createElement("button")).addClass("arrow "+this.settings.classes.arrow),k.prepend(c)),this.settings.hideFiles&&(o=e.grep(f.children,function(e){return"folder"===e.type}),o.length>0&&k.removeClass("is-collapsed").addClass("is-empty")),e.isArray(f.children)&&this._createTree.call(this,k,f.children,p+"/")),k=this.settings.nodeFormatter.call(null,k),b.append(k)}return this.settings.columnView?(h=e(document.createElement("div")).addClass("columns"),h.append(b),n.append(h)):n.append(b)},t.prototype._openFolder=function(t){var i,s,n,l,r,o,a,c,d,h;return t.hasClass("disabled")?!1:(i=t.find("> a"),l=e(this.element),s=t.find(this.settings.columnView?"> .columns":"> ul"),d=this,a=e.Event("folder.open.filetree"),o=e.Event("folder.opened.filetree"),l.trigger(a),void(this.settings.columnView?(h=l.find(".list-group-wrapper").eq(0),n=t.closest(".columns"),c=n.position().left+n.outerWidth()+h.scrollLeft(),this._selectItem(t),s.find("> ul > li").length>0?(r=s.clone(!0),r.find("> ul").data("_parent",i),r.css("left",c+"px"),r.appendTo(h)):h.append('<div class="columns empty" style="left: '+c+'px"><p>empty folder</p></div>'),h.scrollLeft(c),l.trigger(o)):s.slideDown(d.settings.animationSpeed,function(){return t.removeClass("is-collapsed").addClass("is-expanded"),s.hide(),l.trigger(o)})))},t.prototype._closeFolder=function(t){var i,s,n,l,r,o;i=t.find("> a"),s=this.settings.columnView?t.closest(".columns"):t.find("> ul"),o=this,n=e(this.element),r=e.Event("folder.close.filetree"),l=e.Event("folder.closed.filetree"),n.trigger(r),this.settings.columnView?(s.nextAll(".columns").remove(),n.trigger(l)):s.slideUp(o.settings.animationSpeed,function(){t.removeClass("is-expanded").addClass("is-collapsed"),s.removeAttr("style"),n.trigger(l)})},t.prototype._selectItem=function(t){var i;return t.hasClass("disabled")?!1:(i=this.settings.columnView?t.closest(".columns"):e(this.element),i.find("li.active").removeClass("active"),this.settings.columnView&&this._closeFolder(t),void t.addClass("active"))},t.prototype._triggerClickEvent=function(t){var i,s,n,l,r;s=e(this.element),r=this,this._clicks++,i=e(t.target),l=i.closest("li").hasClass("folder")?"folder":"file",n=i.data(),1===this._clicks?this._timer=setTimeout(function(){r._clicks=0,i.trigger(l+".click.filetree",n)},r.settings.dblclickDelay):(clearTimeout(this._timer),i.trigger(l+".dblclick.filetree",n),this._clicks=0),t.preventDefault()},t.prototype._addListeners=function(){var t,i;t=e(this.element),i=this,t.on("click","li.folder > a, li.file > a",this._triggerClickEvent.bind(this)),this.settings.columnView||t.on("click","li.folder.is-collapsed > button.arrow",function(t){i._openFolder(e(t.target).closest("li")),t.stopImmediatePropagation()}).on("click","li.folder.is-expanded > button.arrow",function(t){i._closeFolder(e(t.target).closest("li")),t.stopImmediatePropagation()}),this.settings.multiselect&&this.settings.hierarchialCheck&&t.on("change","input[type=checkbox]:not([disabled])",function(i){var s,n;s=e(i.target).closest("li"),s.hasClass("folder")&&!s.hasClass("is-empty")&&(n=s.find("> input[type=checkbox]:not([disabled])").prop("checked"),s.find("> ul").find("input[type=checkbox]:not([disabled])").prop("checked",n).prop("indeterminate",!1)),s.parentsUntil(t,"li.folder").each(function(){var t,i,s,n;return t=e(this),s=t.find("> ul").find("input[type=checkbox]:not([disabled])"),n=t.find("> input[type=checkbox]:not([disabled])"),i=t.find("> ul").find("input[type=checkbox]:not([disabled]):checked"),i.length>0?(n.semicheck(),i.length===s.length?n.check():void 0):n.uncheck()}),i.stopImmediatePropagation()})},t.prototype._parseTree=function(t){var i,s,n,l,r,o,a,c,d,h,p,u,f;for(i=e(t),s=e(document.createElement("span")).insertAfter(i),i.detach(),a=i.find("> li"),d=0,p=a.length;p>d;d++){if(o=a[d],f=e(o).find("> ul"),r=e(f).find("> li"),r.length>0||e(o).hasClass("folder"))for(n=e(document.createElement("button")).addClass("arrow"),e(o).addClass("folder has-children is-collapsed").prepend(n),h=0,u=f.length;u>h;h++)c=f[h],this._parseTree(c);else e(o).addClass("file");"list"===this.settings.style&&this.settings.multiselect===!0&&(l=e(document.createElement("input")).attr("type","checkbox"),e(o).prepend(l))}return i.find("li > a[data-type=folder]").closest("li").addClass("folder").removeClass("file"),i.insertBefore(s),s.remove()},t.prototype._nameSort=function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0},t}(),i=function(i,s){var n;return n=this,this.each(function(){var l,r;l=e(this),r=l.data("$.filetree"),r||l.data("$.filetree",r=new t(this,i)),"string"==typeof i&&"_"!==i.substr(0,1)&&(n=r[i].call(r,s))}),n},i.VERSION="0.3.0",n=e.fn.filetree,e.fn.filetree=i,e.fn.filetree.Constructor=t,e.fn.filetree.noConflict=function(){return e.fn.filetree=n,this}});