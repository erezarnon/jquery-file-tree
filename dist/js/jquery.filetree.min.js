var hasProp={}.hasOwnProperty;!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){var t,i,n,s;e.fn.check=function(){return this.each(function(){return e(this).prop("indeterminate",!1).prop("checked",!0)})},e.fn.uncheck=function(){return this.each(function(){return e(this).prop("indeterminate",!1).prop("checked",!1)})},e.fn.semicheck=function(){return this.each(function(){return e(this).prop("indeterminate",!0).prop("checked",!1)})},e.fn.togglecheck=function(){return this.each(function(){var t;return t=e(this),t.prop("checked",!t.prop("checked"))})},n={data:[],ajax:!1,url:"./",requestSettings:{},responseHandler:function(e){return e},animationSpeed:400,hideFiles:!1,fileNodeName:"name",folderNodeName:"name",fileNodeTitle:"name",folderNodeTitle:"name",nodeFormatter:function(e){return e},columnView:!1,dblclickDelay:200,classes:{arrow:"glyphicon glyphicon-chevron-right"},searchInput:null,checkboxes:!1,hierarchialCheck:!0},t=function(){function t(t,i){this.element=t,this.settings=e.extend({},n,i),this._defaults=n,this._clicks=0,this._timer=null,this._itemId=0,this._lookup={},this.settings.checkboxes=this.settings.columnView?!1:void 0,this._init()}return t.prototype.open=function(t){var i;return i=e(t).closest("li"),i.hasClass("folder")?(this._openFolder(i),this):!1},t.prototype.close=function(t){var i;return i=e(t).closest("li"),i.hasClass("folder")?(this._closeFolder(i),this):!1},t.prototype.toggle=function(t){var i;return this.settings.columnView||(i=e(t).closest("li"),i.hasClass("is-collapsed")?this._openFolder(i):i.hasClass("is-expanded")&&this._closeFolder(i)),this},t.prototype.select=function(t){return this._selectItem(e(t).closest("li")),this.settings.checkboxes&&e(t).siblings("input[type=checkbox]").togglecheck().change(),this},t.prototype.getSelectedNodes=function(){return this.settings.checkboxes&&e(this.element).find("input[type=checkbox]:checked").map(function(t,i){return e(i).siblings("a")}).get(),!1},t.prototype.getActivePath=function(){var t;return t=this.settings.columnView?e(this.element).find(".active"):e(this.element).find(".active > a").parentsUntil(this.element,"li.folder"),t=t.map(function(t,i){return e(i).find("> a").text()}).get(),this.settings.columnView||t.reverse(),t.join("/")},t.prototype.expandTo=function(t){var i,n,s,l,r,o,a,c;if(t=t.replace(/^\/|\/$/g,"").split("/"),i=e(this.element),this.settings.columnView)for(i=i.find("> .file-tree-wrapper"),l=r=0,a=t.length;a>r;l=++r){if(n=t[l],s=i.find("> .columns").eq(l).find("> ul.file-tree-dir > li > a").filter(function(){return e(this).text()===n}),s.length<1)throw new Error("The folder/file "+n+" does not exists");this.open(s),l===t.length-1&&e(s).click()}else for(this.collapseAll(!0),l=o=0,c=t.length;c>o;l=++o){if(n=t[l],i=i.find("> ul.file-tree-dir > li").filter(function(){return e(this).find("> a").text()===n}),i.length<1)throw new Error("The folder/file "+n+" does not exists");this._openFolder(i),this._selectItem(i),l===t.length-1&&i.find("> a").click()}return this},t.prototype.expandAll=function(t){var i;return this.settings.columnView||(i=this,t&&(this.settings._animationSpeed=this.settings.animationSpeed,this.settings.animationSpeed=0),e(this.element).find("li.folder.is-collapsed > a").each(function(e,t){return i.open(t)}),t&&(this.settings.animationSpeed=this.settings._animationSpeed,delete this.settings._animationSpeed)),this},t.prototype.collapseAll=function(t){var i;return i=this,this.settings.columnView?e(this.element).find(".columns:not(:first-child)").remove().end().find(".active").removeClass("active"):(t&&(this.settings._animationSpeed=this.settings.animationSpeed,this.settings.animationSpeed=0),e(this.element).find("li.folder.is-expanded > a").each(function(e,t){return i.close(t)}),t&&(this.settings.animationSpeed=this.settings._animationSpeed,delete this.settings._animationSpeed)),this},t.prototype.destroy=function(){return e(this.element).data("$.filetree",null),e(this.element).off().empty(),this},t.prototype._init=function(){var t,i,n,s,l;return l=this,t=e(this.element).addClass("file-tree"),i=e(document.createElement("span")).insertAfter(e(this.element)),e(this.element).detach(),this.settings.columnView&&(t.addClass("file-tree-columns"),t=e(document.createElement("div")).addClass("file-tree-root").appendTo(t)),n=this.settings.data,s=this,this.settings.ajax?e.ajax(this.settings.url,this.settings.requestSettings).then(function(e){return e=s.settings.responseHandler(e),s._createTree.call(s,t,e)}):e.isArray(n)&&n.length>0?this._createTree.call(this,t,n):this._parseTree.call(this,t),this._addListeners(),e(this.element).insertBefore(i),i.remove(),n=null,this.element},t.prototype._createTree=function(t,i,n){var s,l,r,o,a,c,d,h,p,f,u,m,g,y,v,_,k,C,w,x,b;for(null==n&&(n="/"),s=e(t),l=[],r=[],m=0,v=i.length;v>m;m++)f=i[m],"folder"===f.type&&r.push(f),"file"===f.type&&l.push(f);for(l.sort(this._nameSort),r.sort(this._nameSort),i=r.concat(l),x=e(document.createElement("ul")).addClass("file-tree-dir"),g=0,_=i.length;_>g;g++)if(u=i[g],"file"!==u.type||this.settings.hideFiles!==!0){k=e(document.createElement("li")).addClass(u.type+" file-tree-file"),a=e(document.createElement("a")).attr("href","#").data("__itemId",++this._itemId),["file","folder"].indexOf(u.type)>-1?(w=u[this.settings[u.type+"NodeTitle"]],C=u[this.settings[u.type+"NodeName"]],p=n+u[this.settings[u.type+"NodeName"]]):(w=C=u.name,p=n+u.name),a.attr("title",w).html(C).data("__path",p),this._lookup[this._itemId+":"+C]=a;for(y in u)hasProp.call(u,y)&&(b=u[y],"children"!==y&&a.data(y,b));this.settings.columnView&&"folder"===u.type&&(c=e(document.createElement("span")).addClass("arrow "+this.settings.classes.arrow),a.append(c)),k.append(a),this.settings.multiselect&&(d=e(document.createElement("input")).attr("type","checkbox"),u.readOnly&&(d.prop("disabled",!0),k.addClass("is-read-only")),k.prepend(d)),"folder"===u.type&&(k.addClass("is-collapsed"),("undefined"===u.children||u.children.length<1)&&k.addClass("is-empty"),this.settings.hideFiles&&(o=e.grep(u.children,function(e){return"folder"===e.type}),o.length>0&&k.removeClass("is-collapsed").addClass("is-empty")),e.isArray(u.children)&&(this._createTree.call(this,k,u.children,p+"/"),this._closeFolder(k))),k=this.settings.nodeFormatter.call(null,k),x.append(k)}return this.settings.columnView?(h=e(document.createElement("div")).addClass("columns"),h.append(x),s.append(h)):s.append(x)},t.prototype._openFolder=function(t){var i,n,s,l,r,o,a,c,d,h;return t.hasClass("disabled")?!1:(i=t.find("> a"),l=e(this.element),n=t.find(this.settings.columnView?"> .columns":"> ul"),d=this,a=e.Event("folder.open.filetree"),o=e.Event("folder.opened.filetree"),l.trigger(a),void(this.settings.columnView?(h=l.find(".file-tree-wrapper").eq(0),s=t.closest(".columns"),c=s.position().left+s.outerWidth()+h.scrollLeft(),this._selectItem(t),n.find("> ul > li").length>0?(r=n.clone(!0),r.find("> ul").data("_parent",i),r.css("left",c+"px"),r.appendTo(h)):h.append('<div class="columns empty" style="left: '+c+'px"><p>empty folder</p></div>'),h.scrollLeft(c),l.trigger(o)):n.slideDown(d.settings.animationSpeed,function(){return t.removeClass("is-collapsed").addClass("is-expanded"),n.hide(),l.trigger(o)})))},t.prototype._closeFolder=function(t){var i,n,s,l,r,o;i=t.find("> a"),n=this.settings.columnView?t.closest(".columns"):t.find("> ul"),o=this,s=e(this.element),r=e.Event("folder.close.filetree"),l=e.Event("folder.closed.filetree"),s.trigger(r),this.settings.columnView?(n.nextAll(".columns").remove(),s.trigger(l)):n.slideUp(o.settings.animationSpeed,function(){t.removeClass("is-expanded").addClass("is-collapsed"),n.removeAttr("style"),s.trigger(l)})},t.prototype._selectItem=function(t){var i;return t.hasClass("disabled")?!1:(i=this.settings.columnView?t.closest(".columns"):e(this.element),i.find("li.active").removeClass("active"),this.settings.columnView&&this._closeFolder(t),void t.addClass("active"))},t.prototype._triggerClickEvent=function(t){var i,n,s,l,r;n=e(this.element),r=this,this._clicks++,i=e(t.target),l=i.closest("li").hasClass("folder")?"folder":"file",s=i.data(),1===this._clicks?this._timer=setTimeout(function(){r._clicks=0,i.trigger(l+".click.filetree",s)},r.settings.dblclickDelay):(clearTimeout(this._timer),i.trigger(l+".dblclick.filetree",s),this._clicks=0),t.preventDefault()},t.prototype._addListeners=function(){var t,i;t=e(this.element),i=this,t.on("click","li.folder > a, li.file > a",this._triggerClickEvent.bind(this)),this.settings.columnView||t.on("click","li.folder.is-collapsed",function(t){i._openFolder(e(t.target).closest("li")),t.stopImmediatePropagation()}).on("click","li.folder.is-expanded",function(t){i._closeFolder(e(t.target).closest("li")),t.stopImmediatePropagation()}),this.settings.multiselect&&this.settings.hierarchialCheck&&t.on("change","input[type=checkbox]:not([disabled])",function(i){var n,s;n=e(i.target).closest("li"),n.hasClass("folder")&&!n.hasClass("is-empty")&&(s=n.find("> input[type=checkbox]:not([disabled])").prop("checked"),n.find("> ul").find("input[type=checkbox]:not([disabled])").prop("checked",s).prop("indeterminate",!1)),n.parentsUntil(t,"li.folder").each(function(){var t,i,n,s;return t=e(this),n=t.find("> ul").find("input[type=checkbox]:not([disabled])"),s=t.find("> input[type=checkbox]:not([disabled])"),i=t.find("> ul").find("input[type=checkbox]:not([disabled]):checked"),i.length>0?(s.semicheck(),i.length===n.length?s.check():void 0):s.uncheck()}),i.stopImmediatePropagation()})},t.prototype._parseTree=function(t){var i,n,s,l,r,o,a,c,d,h,p,f;for(i=e(t),n=e(document.createElement("span")).insertAfter(i),i.detach(),o=i.find("> li"),c=0,h=o.length;h>c;c++){if(r=o[c],f=e(r).find("> ul"),l=e(f).find("> li"),l.length>0||e(r).hasClass("folder"))for(d=0,p=f.length;p>d;d++)a=f[d],this._parseTree(a);else e(r).addClass("file");"list"===this.settings.style&&this.settings.multiselect===!0&&(s=e(document.createElement("input")).attr("type","checkbox"),e(r).prepend(s))}return i.find("li > a[data-type=folder]").closest("li").addClass("folder").removeClass("file"),i.insertBefore(n),n.remove()},t.prototype._nameSort=function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0},t}(),i=function(i,n){var s;return s=this,this.each(function(){var l,r;l=e(this),r=l.data("$.filetree"),r||l.data("$.filetree",r=new t(this,i)),"string"==typeof i&&"_"!==i.substr(0,1)&&(s=r[i].call(r,n))}),s},i.VERSION="0.3.0",s=e.fn.filetree,e.fn.filetree=i,e.fn.filetree.Constructor=t,e.fn.filetree.noConflict=function(){return e.fn.filetree=s,this}});